image: python:3.11-slim

pipelines:
  default:
    - step:
        name: Lint (Black)
        caches:
          - pip
        script:
          - pip install --upgrade pip
          - pip install -r requirements-dev.txt
          - black --check .
          - ruff check .
    - step:
        name: Tests
        caches:
          - pip
        script:
          - pip install --upgrade pip
          - pip install -r requirements.txt
          - pip install -r requirements-dev.txt
          - pytest -q
    - step:
        name: Build Docker image
        services:
          - docker
        script:
          - docker build -t scb:${BITBUCKET_COMMIT} .

definitions:
  caches:
    pip: ~/.cache/pip